<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Basic Document Setup -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Page Title & Metadata -->
    <title>AI-Powered Insights</title>
    <meta 
      name="description" 
      content="Analyze social media engagement data with AI-driven insights."
    />

    <!-- Minimal Inline Styles -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: sans-serif;
        background: #fafafa;
        color: #333;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem;
        min-height: 100vh;
      }
      header {
        margin-bottom: 2rem;
        text-align: center;
      }
      h1 {
        font-size: 2rem;
        margin-bottom: 1rem;
      }
      p {
        max-width: 600px;
        margin: 0 auto 1.5rem;
        line-height: 1.5;
      }
      .cta-button {
        padding: 0.75rem 1.5rem;
        background: #000;
        color: #fff;
        text-decoration: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s ease;
      }
      .cta-button:hover {
        background: #555;
      }
      .results-section {
        margin-top: 2rem;
        max-width: 600px;
        width: 100%;
      }
      .results-section h2 {
        margin-bottom: 0.5rem;
      }
      .result {
        background: #fff;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      footer {
        margin-top: auto;
        padding: 2rem 0;
        text-align: center;
      }
      footer span {
        font-size: 0.9rem;
        color: #777;
      }
    </style>
  </head>

  <body>
    <!-- Header & Description -->
    <header>
      <h1>AI-Powered Social Media Insights</h1>
      <p>Get a quick look at your post-performance metrics. Powered by DataStax Astra, Langflow, and GPT.</p>
      <button class="cta-button" id="ctaButton">Get Insights</button>
    </header>

    <!-- Results Section (Initially empty) -->
    <div class="results-section" id="resultsSection">
      <!-- Engagement results will appear here -->
    </div>

    <!-- Footer -->
    <footer>
      <span>&copy; 2025 AI Insights. All rights reserved.</span>
    </footer>

    <!-- JavaScript -->
    <script>
      // *******************************
      // 1. Mock Data & Database Calls
      // *******************************

      /**
       * This function simulates fetching data from Astra DB.
       * In a real-world scenario, you would make an API call to your server
       * that connects to Astra DB and retrieves data for the requested post type.
       */
      async function fetchEngagementData(postType) {
        // Example dataset simulating DB results:
        const mockData = [
          { postType: 'carousel', likes: 120, shares: 30, comments: 15 },
          { postType: 'reels',    likes: 200, shares: 40, comments: 50 },
          { postType: 'static',   likes: 90,  shares: 10, comments: 5  },
          // Add more if needed...
        ];

        // Filter mock data for the requested type.
        const filtered = mockData.filter(item => item.postType === postType);
        if (filtered.length === 0) {
          return null; // No data for that post type
        }

        // Simulate asynchronous call
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve(filtered);
          }, 500);
        });
      }

      /**
       * This function simulates sending data to Langflow for analysis.
       * In a real-world scenario, you would call your Langflow endpoint
       * with the relevant data to run your Flow, which calculates average engagement
       * metrics and interacts with GPT for final insights.
       */
      async function analyzeDataWithLangflow(data) {
        // Calculate average metrics:
        const totalLikes = data.reduce((sum, item) => sum + item.likes, 0);
        const totalShares = data.reduce((sum, item) => sum + item.shares, 0);
        const totalComments = data.reduce((sum, item) => sum + item.comments, 0);
        const avgLikes = (totalLikes / data.length).toFixed(1);
        const avgShares = (totalShares / data.length).toFixed(1);
        const avgComments = (totalComments / data.length).toFixed(1);

        // Simulate GPT-based insight generation:
        const insight = generateGPTInsights(avgLikes, avgShares, avgComments);

        // Simulate asynchronous call
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({ avgLikes, avgShares, avgComments, insight });
          }, 500);
        });
      }

      /**
       * This function simulates GPT-based insight generation.
       * In a real scenario, GPT would refine or elaborate upon these insights.
       */
      function generateGPTInsights(avgLikes, avgShares, avgComments) {
        // Example "insights" string based on data
        return `
          Your posts show an average of ${avgLikes} likes, 
          ${avgShares} shares, and ${avgComments} comments. 
          This indicates a strong engagement rate overall. 
          Consider exploring more user-generated content to drive even higher comments.
        `;
      }

      // *******************************
      // 2. User Interaction & Display
      // *******************************

      const ctaButton = document.getElementById('ctaButton');
      const resultsSection = document.getElementById('resultsSection');

      ctaButton.addEventListener('click', async () => {
        // Ask user for the post type input
        const userPostType = prompt('Enter the type of post: "carousel", "reels", or "static"');

        if (!userPostType) {
          alert('No post type provided. Please try again.');
          return;
        }

        // 1. Fetch Engagement Data from Astra DB
        const engagementData = await fetchEngagementData(userPostType.toLowerCase());
        if (!engagementData) {
          alert('No data found for that post type. Please try "carousel", "reels", or "static".');
          return;
        }

        // 2. Analyze Post Performance with Langflow
        const analysis = await analyzeDataWithLangflow(engagementData);

        // 3. Provide AI-Generated Insights
        displayResults(userPostType, analysis);
      });

      /**
       * Displays the final insights on the page
       */
      function displayResults(postType, analysis) {
        resultsSection.innerHTML = `
          <div class="result">
            <h2>Post Type: ${postType.toUpperCase()}</h2>
            <p><strong>Average Likes:</strong> ${analysis.avgLikes}</p>
            <p><strong>Average Shares:</strong> ${analysis.avgShares}</p>
            <p><strong>Average Comments:</strong> ${analysis.avgComments}</p>
            <p><strong>GPT Insights:</strong> ${analysis.insight}</p>
          </div>
        `;
      }
    </script>
  </body>
</html>
